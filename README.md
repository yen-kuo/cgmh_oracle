# cgmh_oracle
# ğŸ“¦ Oracle ä½œæ¥­èªªæ˜æ›¸ â€” å¤–è³¼æš«ä¼°æˆæœ¬è³‡æ–™ç”¢ç”Ÿ

## ğŸ§¾ ä½œæ¥­åç¨±
**ç”¢ç”Ÿå¤–è³¼æ”¶æ–™çš„æš«ä¼°è²»ç”¨è³‡æ–™**

## ğŸ§  ç¨‹å¼ç›®çš„
æœ¬ç¨‹å¼ä¸»è¦é‡å°å…©å€‹æœˆå‰çš„å¤–è³¼æ”¶æ–™è³‡æ–™ (`RSUPRECV`)ï¼Œä¾ç…§ç‰¹å®šæ¢ä»¶èˆ‡è²»ç”¨é …ç›® (`FID`)ï¼Œæª¢æŸ¥æ˜¯å¦å·²æœ‰æš«ä¼°è¨˜éŒ„ï¼Œè‹¥ç„¡å‰‡ä¾è¦å‰‡å¯«å…¥ `RFPRMAIN` è¡¨ä¸­ï¼Œä¸¦è£œä¸Šæš«ä¼°é‡‘é¡ã€‚

---

## ğŸ“‚ ç¨‹å¼æ¶æ§‹

### 1. å®£å‘Šå€ï¼ˆDeclarationsï¼‰
- `SYS`: å„²å­˜ç³»çµ±æ—¥æœŸ
- `CurRecv`: æŸ¥è©¢å…©å€‹æœˆå‰ç¬¦åˆæ¢ä»¶çš„æ”¶æ–™è³‡æ–™ï¼ˆæ¢ä»¶ï¼š`NL = '9'`ã€`ORDID = '1'`ï¼‰
- `CurEITM`: çµ„åˆ GPA1ã€GPAF åŠæ‰‹å‹•å®šç¾©çš„æš«ä¼°é …ç›®ï¼ˆAKã€AXã€ALï¼‰
- `CurTPEST`: æŸ¥è©¢å·²å­˜åœ¨ä½†æš«ä¼°é‡‘é¡ç‚º 0 çš„ç´€éŒ„

---

### 2. `Function checkEst(...)`
- **ç”¨é€”**ï¼šæª¢æŸ¥æ˜¯å¦å·²æœ‰æš«ä¼°è²»ç”¨è³‡æ–™
- **å‚³å›å€¼**ï¼š
  - `0`: æœªå­˜åœ¨
  - `>0`: å·²å­˜åœ¨

---

### 3. `Function getTpEstAmt(...)`
- **ç”¨é€”**ï¼šä¾æ“š `FID` å–å¾—é è¨­çš„æš«ä¼°é‡‘é¡
- **ä¾†æºè³‡æ–™è¡¨**ï¼š`RFprexch`
- **ä¾‹å¤–è™•ç†**ï¼šæŸ¥ä¸åˆ°è³‡æ–™æ™‚å›å‚³ `-2`

---

### 4. `Procedure insertEst(...)`
- **ç”¨é€”**ï¼šæ ¹æ“šé‚è¼¯ç”¢ç”Ÿä¸¦å¯«å…¥æš«ä¼°é‡‘é¡è‡³ `RFPRMAIN`
- **åˆ¤æ–·é‚è¼¯**ï¼š
  - è‹¥ç‚º `AK`ã€`AF`ã€`AX`ã€`AL`ï¼šä½¿ç”¨ `getTpEstAmt` æŠ“é è¨­é‡‘é¡
  - è‹¥ç‚º `A2`ã€`AA`ã€`AB`ã€`An`ã€`AM`ã€`AS`ï¼šè¨­ç‚ºéœ€ PESï¼ˆä¸é€²è¡Œå¯«å…¥ï¼‰
  - å…¶ä»–ï¼šå¾ `RSUPIMSD` æŠ“å–é‡‘é¡ï¼Œä¹˜ä¸ŠåŒ¯ç‡ (`EXR`)ï¼Œå¯«å…¥æš«ä¼°

---

### 5. ä¸»ç¨‹å¼æµç¨‹
1. è¨˜éŒ„ç•¶å‰ç³»çµ±æ—¥æœŸè‡³ `SYS`
2. é€ç­†è®€å– `CurRecv` ä¸­çš„æ”¶æ–™è³‡æ–™
3. å°æ¯ç­†æ”¶æ–™è³‡æ–™ï¼Œè·‘æ‰€æœ‰æš«ä¼°é …ç›® `CurEITM`
   - å‘¼å« `checkEst()` åˆ¤æ–·æ˜¯å¦å·²æœ‰è³‡æ–™
   - è‹¥ç„¡å‰‡å‘¼å« `insertEst()` æ’å…¥è³‡æ–™
   - è‹¥å·²æœ‰è³‡æ–™ä¸”æš«ä¼°é‡‘é¡ç‚º 0ï¼Œå‰‡ç”¨ `CurTPEST` æ›´æ–°é‡‘é¡ç‚º `TPBRWAMT`

---

## ğŸ“ è¼¸å‡ºå…§å®¹ï¼ˆ`DBMS_OUTPUT`ï¼‰
- å°å‡ºè™•ç†é€²åº¦ï¼Œå¦‚ï¼š
  - `12345678æš«ä¼°AK`ï¼ˆæ–°å»ºç«‹ï¼‰
  - `12345678AKå·²ç¶“æš«ä¼°`ï¼ˆå·²å­˜åœ¨ï¼‰

---

## âš ï¸ éŒ¯èª¤è™•ç†
- ä½¿ç”¨ `WHEN OTHERS THEN` æ•æ‰ä»»ä½•ä¾‹å¤–ï¼Œä¸¦å°å‡ºéŒ¯èª¤è¨Šæ¯ (`SQLERRM`)

---

## ğŸ“Œ è£œå……èªªæ˜
- æ‰€æœ‰æ—¥æœŸæ¬„ä½çµ±ä¸€ä½¿ç”¨ `2024/05/31` ä½œç‚ºæš«ä¼°æ—¥æœŸ (`TPESTDAT`)
- æŸ¥è©¢çš„æ”¶æ–™æ—¥æœŸæ ¼å¼ç‚ºæ°‘åœ‹å¹´æœˆï¼ˆä¾‹å¦‚ï¼š`11303%`ï¼‰
- æœ¬ç¨‹å¼ä¸»è¦èˆ‡ä»¥ä¸‹è³‡æ–™è¡¨äº’å‹•ï¼š
  - `RSUPRECV`ï¼ˆæ”¶æ–™ä¸»æª”ï¼‰
  - `RFPRMAIN`ï¼ˆæš«ä¼°ä¸»æª”ï¼‰
  - `RFPREXCH`ï¼ˆè²»ç”¨ä»£ç¢¼èˆ‡åŒ¯ç‡ï¼‰
  - `RSUPIMSD`ï¼ˆæ”¶æ–™æ˜ç´°ï¼‰

---

> ğŸ“… ä½œè€…ï¼šä¸­å±±é†«é†«è³‡ç³»  
> ğŸ’¾ åŸ·è¡Œç’°å¢ƒï¼šOracle PL/SQL  
> ğŸ› ï¸ å»ºè­°ä½¿ç”¨å·¥å…·ï¼šSQL Developer / TOAD / PL/SQL Developer
